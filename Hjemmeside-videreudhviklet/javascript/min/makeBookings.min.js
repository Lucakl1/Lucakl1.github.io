var BookingInfo={};function activateSubmitButton(){const submitButton=document.getElementById("make_booking");if(formIsFilled())submitButton.classList.remove("disabled");else{if(submitButton.classList.contains("disabled"))return;submitButton.classList.add("disabled")}}function onRecaptchaSuccess(){formIsFilled()&&activateSubmitButton()}function onRecaptchaExpired(){activateSubmitButton()}async function makeRequestBooking(){const{access_token:access_token,logged_in_via:logged_in_via}=await signIn();var response;if(fillFormAndCheck())if("anonymous@example.com"==logged_in_via){if(publicResponse=await fetch(`${supabaseUrl}/rest/v1/currentPublicBookings`,{method:"POST",headers:{"Content-Type":"application/json",apikey:supabaseKey,Authorization:`Bearer ${access_token}`,Prefer:"return=representation"},body:JSON.stringify([{...publicBookingInfo,bookingID:"Requested"}])}),!publicResponse.ok)return void alert("Noget gik galt, prøv igen!");const publicResponseJson=await publicResponse.json();(response=await fetch(`${supabaseUrl}/rest/v1/requestBooking`,{method:"POST",headers:{"Content-Type":"application/json",apikey:supabaseKey,Authorization:`Bearer ${access_token}`},body:JSON.stringify([{...BookingInfo,bookingID:"R"+publicResponseJson[0].id}])})).ok?(sendMail(),window.location="bookingConfirmed.html"):alert("Noget gik galt, prøv igen!")}else{if(!(response=await fetch(`${supabaseUrl}/rest/v1/acceptedBooking`,{method:"POST",headers:{"Content-Type":"application/json",apikey:supabaseKey,Authorization:`Bearer ${access_token}`,Prefer:"return=representation"},body:JSON.stringify([{...BookingInfo}])})).ok)return void alert("Noget gik galt, prøv igen!");const responseJson=await response.json();publicResponse=await fetch(`${supabaseUrl}/rest/v1/currentPublicBookings`,{method:"POST",headers:{"Content-Type":"application/json",apikey:supabaseKey,Authorization:`Bearer ${access_token}`,Prefer:"return=representation"},body:JSON.stringify([{...publicBookingInfo,bookingID:"A"+responseJson[0].id}])}),publicResponse.ok?(sendMail(),window.location="bookingConfirmed.html"):alert("Noget gik galt, prøv igen!")}}function formIsFilled(giveInfo=!1){const requiredFields=document.querySelectorAll("[required]");var return_this=!0;requiredFields.forEach((field=>{""!=field.value.trim()&&null!=field.value&&null!=field.value||(return_this=!1,!field.classList.contains("not-filled")&&giveInfo&&(field.classList.add("not-filled"),field.addEventListener("input",(()=>{field.classList.remove("not-filled")}))))}));document.getElementById("sammentygge").checked||(return_this=!1,giveInfo&&alert("Du skal godkende databeskyttelseslovgivning for at kunne booke"));return 0===grecaptcha.getResponse().length&&(return_this=!1,giveInfo&&alert("Husk at godkende at du ikke er en robot")),return_this}function fillFormAndCheck(giveMessage=!0){if(BookingInfo={},!formIsFilled(giveMessage))return!1;const selectedServices=JSON.parse(localStorage.getItem("selectedservices"));if(!selectedServices)return giveMessage&&alert("Du mangler at vælge en service"),window.location="booking.html",!1;const email=document.getElementById("email").value,fulde_navn=document.getElementById("fullname").value,tlf=document.getElementById("tlf").value,start_time=selectedServices.datetime,duration=selectedServices.totalTime,adress=document.getElementById("autocomplete_adresse").value,houseNumber=document.getElementById("autocomplete_house_number").value,postalcode=document.getElementById("autocomplete_postal_code").value,by=document.getElementById("autocomplete_by").value,udAdress=document.getElementById("ud_adress").value||"",udHouseNumber=document.getElementById("ud_husnummer").value||"",udPostalcode=document.getElementById("ud_postal_code").value||"",udBy=document.getElementById("ud_by").value||"",message=document.getElementById("message").value||"",services=selectedServices.services;return BookingInfo={email:email,fulde_navn:fulde_navn,tlf:tlf,start_time:start_time,duration:duration,adress:`${adress} ${houseNumber}, ${postalcode} ${by}`,location_for_work:`${udAdress} ${udHouseNumber}, ${udPostalcode} ${udBy}`,message:message,services:services},publicBookingInfo={duration:duration,start_time:start_time},!0}function sendMail(){emailjs.init("8on1XAeHXO55DA6Tp");const email_info={name:document.getElementById("fullname").value,email:document.getElementById("email").value};emailjs.send("service_kesfnw1","template_h23bpoo",email_info).then((()=>{}),(error=>{console.log("FAILED...",error)}))}document.addEventListener("DOMContentLoaded",(()=>{document.querySelectorAll("[required]").forEach((field=>{field.addEventListener("change",(event=>{event.preventDefault(),activateSubmitButton()}))}));document.getElementById("sammentygge").addEventListener("change",(event=>{event.preventDefault(),activateSubmitButton()}));document.getElementById("make_booking").addEventListener("click",(event=>{event.preventDefault(),makeRequestBooking()}))}));